---
title: "TO414_Group_11_Project_4"
author: "Jack Perlmuter, Ross Coyne, Logan Sabella, Mason Wicklander, Antonio De Llergo"
date: "2/21/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Laying out the Problem
We have chosen a data set that highlights whether or not patients had strokes and other associated information. We intend to build a model that can accurately predict whether or not a patient will have a stroke based on the presence of certain dependent variables (such as gender, heart disease, bmi). The business implications of this are for physicians to be able to plug their patients' information into our model and be able to predict whether or not the patient is going to have a stroke. As a result, patients can be made aware of their potential risk of stroke and stroke deaths can be prevented.


# Importing the Data Set and Cleaning It
```{r}
stroke_data <- read.csv("healthcare-dataset-stroke-data.csv")

#Observing summary and structure of data to identify what we need to clean
summary(stroke)
str(stroke)

#We decided to set ID to NULL, as it is an irrelevant variable
stroke$id <- NULL

#Renamed column stroke in order to prevent confusion
stroke$had_stroke = stroke$stroke
stroke$stroke = NULL

#We set the following columns as factors instead of characters
stroke$gender <- as.factor(stroke$gender)
stroke$smoking_status <- as.factor(stroke$smoking_status)
stroke$ever_married <- as.factor(stroke$ever_married)
stroke$work_type <- as.factor(stroke$work_type)
stroke$Residence_type <- as.factor(stroke$Residence_type)

#We set bmi to be numeric, as it was a character to begin. Then, we removed all NAs and replaced them with the mean (difference between mean and median was negligible, so we decided to preserve the mean)
stroke$bmi <- as.numeric(stroke$bmi)
stroke$bmi <- ifelse(is.na(stroke$bmi), mean(stroke$bmi, na.rm = T),stroke$bmi)

#Observing summary and structure of the cleaned data
summary(stroke)
str(stroke)
```

## Splitting Data Into Train and Test
```{r}
set.seed(17)
test_set = sample(1:nrow(stroke), round(nrow(stroke)*.3))

stroke_log_test = stroke[test_set,]
stroke_log_train = stroke[-test_set,]

# Using model.matrix to convert all the factors to dummy variables
# We are converting all of the factors into dummy variables as the input into knn has to be numeric

strokemm <- as.data.frame(model.matrix(~.-1,stroke))
str(strokemm)

#Normalize the data
normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}

stroke_random <- strokemm[sample(nrow(strokemm)),]
# we are going to normalize everything 
stroke_norm <- as.data.frame(lapply(stroke_random, normalize))

```


# Understanding the Data
```{r}
num_of_strokes = as.factor(stroke$had_stroke)
summary(num_of_strokes)

num_of_heart_disease = as.factor(stroke$heart_disease)
summary(num_of_heart_disease)
```

<<<<<<< HEAD
=======
# Linear Regression
```{r}
linear.model<-lm(had_stroke~.,data=stroke)

summary(linear.model)

plot(linear.model)

new.linear.model<-lm(had_stroke~age+hypertension+heart_disease+ever_married+work_type+avg_glucose_level,data=stroke)

summary(new.linear.model)
```



# Building an ANN Model
```{r}
library(neuralnet)
library(caret)

stroke_train_ann <- stroke_norm[-test_set, ]
stroke_test_ann <- stroke_norm[test_set, ]



#My ANN model 
stroke.ann <- neuralnet(formula = had_stroke ~ .,
                              data = stroke_train_ann, hidden = 1, stepmax = 1e+06)

# Visualize the network topology
plot(stroke.ann)

# Create a confusion matrix to see model accuracy
stroke_ann_pred <- predict(stroke.ann,stroke_test_ann,type = "response")
stroke_ann_pred <- ifelse(stroke_ann_pred > 0.4, 1, 0)
confusionMatrix(as.factor(stroke_ann_pred),as.factor(stroke_test_ann$had_stroke),positive = "1")

```

>>>>>>> d0b2f5ac2fe46a3f57a095dce6bcae52db419171
# Logit
```{r}
logit.model <- glm(had_stroke ~ ., data = stroke, family = "binomial")
summary(logit.model)

newlogitmodel <- glm(had_stroke ~ age + hypertension + avg_glucose_level, data = stroke, family = "binomial")
summary(newlogitmodel)
```


# Probit
```{r}
probit.model <- glm(had_stroke ~ ., data = stroke, family = binomial(link="probit"))
summary(probit.model)

#We tried a number of interaction variables but none were significant
newprobitmodel <- glm(had_stroke ~ age + hypertension + work_type + avg_glucose_level, data = stroke, family = binomial(link="probit"))
summary(newprobitmodel)
```

<<<<<<< HEAD
# Building an ANN Model
```{r}
library(neuralnet)


```

=======
# SVM
>>>>>>> d0b2f5ac2fe46a3f57a095dce6bcae52db419171
```{r}
library(kernlab)

stroke_classifier = ksvm(had_stroke ~., data = stroke_log_train, kernel = "vanilladot")
stroke_classifier

stroke_predictions = predict(stroke_classifier, stroke_log_test)

table(stroke_predictions, stroke_log_test$had_stroke)
agreement <- stroke_predictions == stroke_log_test$had_stroke
table(agreement)
prop.table(table(agreement))
```


